<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.73">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="BHDL.org Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="BHDL.org Blog Atom Feed"><title data-react-helmet="true">Getting Started | BHDL.org</title><meta data-react-helmet="true" property="og:url" content="https://bhdl.org/docs/guides/getting-started"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Getting Started | BHDL.org"><meta data-react-helmet="true" name="description" content="A quick taste"><meta data-react-helmet="true" property="og:description" content="A quick taste"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://bhdl.org/docs/guides/getting-started"><link data-react-helmet="true" rel="alternate" href="https://bhdl.org/docs/guides/getting-started" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://bhdl.org/docs/guides/getting-started" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.51901da4.css">
<link rel="preload" href="/assets/js/styles.bbf158e0.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.baa60e6e.js" as="script">
<link rel="preload" href="/assets/js/main.8d2f529b.js" as="script">
<link rel="preload" href="/assets/js/1.0e345cd4.js" as="script">
<link rel="preload" href="/assets/js/2.94e55c7a.js" as="script">
<link rel="preload" href="/assets/js/39.b89f9123.js" as="script">
<link rel="preload" href="/assets/js/41.375d16b8.js" as="script">
<link rel="preload" href="/assets/js/935f2afb.ef568aff.js" as="script">
<link rel="preload" href="/assets/js/17896441.c363ac0b.js" as="script">
<link rel="preload" href="/assets/js/c9ea0dcf.2f61de33.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/examples">Examples</a><a class="navbar__item navbar__link" href="/publications">Publications</a></div><div class="navbar__items navbar__items--right"><a href="https://cloud.bhdl.org" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Cloud</a><a href="https://github.com/bhdl" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link navbar__link--active" href="/docs/intro">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a class="menu__link" href="/examples">Examples</a></li><li class="menu__list-item"><a class="menu__link" href="/publications">Publications</a></li><li class="menu__list-item"><a href="https://cloud.bhdl.org" target="_blank" rel="noopener noreferrer" class="menu__link">Cloud</a></li><li class="menu__list-item"><a href="https://github.com/bhdl" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper docs-wrapper doc-page"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/intro">Introduction</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Guides</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/guides/getting-started">Getting Started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/install">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guides/racket">Racket Crash Course</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Reference</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/api">API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/extra">Extra API</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/admin">Administrator Setup</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/reference/library">Component Library</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">draft</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/draft/questionare">BHDL: Questionare</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Getting Started</h1></header><div class="markdown"><p><img alt="A quick taste" src="/assets/images/taste-9cbc17c6e9f786a773ae2a2aa4bc392a.png"></p><p><img alt="Modular designs" src="/assets/images/module-0b9c26ce8512c021991cae90465487cc.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tutorial-outline"></a>Tutorial Outline<a class="hash-link" href="#tutorial-outline" title="Direct link to heading">#</a></h2><p>The programming with BHDL consists of several steps:</p><ol><li>Component Selection. The information needed are:<ol><li>the Pin definition of the IC</li><li>specify the desired footprint</li></ol></li><li>Use <code>make-circuit</code> API to compose your circuit. Optionally, hierarchical compose your more complex circuit using <code>make-circuit</code>. Each <code>make-circuit</code> API expects several components:<ol><li>what the external pins are</li><li>connect the components using the 4 types of connection syntax</li><li>specify physical layout of components</li></ol></li><li>Expose your design via <code>circuit-export</code> API, to KiCAD, PDF, BOM, etc.</li></ol><p>In this guide, we will go over these steps using a simple keyboard example. We will assume you have a jupyter notebook opened with IRacket kernel. Please refer to the setup documents if you need to setup one, or use our online server.</p><p><img alt="keyboard-3D" src="/assets/images/demo-board-keyboard-3D-24b8d05b02798acc4b42ae332439ee5e.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="setting-up"></a>Setting up<a class="hash-link" href="#setting-up" title="Direct link to heading">#</a></h2><p>The first step is to use the BHDL library via:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scheme"><div tabindex="0" class="prism-code language-scheme codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(putenv &quot;BHDL_LIBRARY_PATH&quot; &quot;~/bhdl/bhdl-footprints&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">(require bhdl)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Note that you must setup <code>BHDL_LIBRARY_PATH</code> ENV variable to your footprint path before requiring the BHDL library.</p><p>We probably also need some racket libraries:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scheme"><div tabindex="0" class="prism-code language-scheme codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(require racket/list</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         racket/format</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         (prefix-in pict: pict))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>We&#x27;ll want to add some global signals to refer:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scheme"><div tabindex="0" class="prism-code language-scheme codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(define global</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (make-circuit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:external-pins (GND 3V3 5V VCC USB5V)))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-keyboard-matrix"></a>The keyboard matrix<a class="hash-link" href="#the-keyboard-matrix" title="Direct link to heading">#</a></h2><p>The components:</p><ul><li>Kailh hot-swap socket: <code>kailh-socket</code></li><li>Diodes: <code>1N4148W</code></li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scheme"><div tabindex="0" class="prism-code language-scheme codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(define (key-with-diode)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (make-circuit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:external-pins (left right)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:vars ([d (1N4148W)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           [key (kailh-socket 1)])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:connect (*- self.left key d self.right)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:layout (vc-append key d)))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>We can call the <code>key-with-diode</code> to create this small circuits for each key.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scheme"><div tabindex="0" class="prism-code language-scheme codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(define matrix</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (for/list ([row (in-range 4)])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            (for/list ([col (in-range 5)])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                      (key-with-diode))))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The <code>matrix</code> variable holds 4x5 keys. We then connect them together:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scheme"><div tabindex="0" class="prism-code language-scheme codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(define matrix-module</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (make-circuit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:external-pins (row[4] col[5])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ;; col in, row out</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:connect (for*/list ([i (in-range 4)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                        [j (in-range 5)])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                       (debug &quot;connecting&quot; i j)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                       (*- self.col[j]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                           (list-ref (list-ref matrix i) j)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                           self.row[i]))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:layout (vc-append</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">             (for/list ([row matrix])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                      (hc-append row ..)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                      ) ..)))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>We note several points here:</p><ul><li>We don&#x27;t use `<code>#:vars</code> to create components, because we are using the <code>matrix</code> variable that is already created</li><li>We specify 4+5 external pins for rows and columns, respectively</li><li>We use a loop to connect the external row and column pins to the corresponding key in the matrix.</li><li>Finally, we specify the layout to be *horizontally append&quot; (via <code>hc-append</code> API) to form the rows and &quot;vertically append&quot; (via <code>vc-append</code> API) to form the columns.</li></ul><p>The end result of the key matrix module looks like this:</p><p><img alt="matrix-image" src="/assets/images/demo-board-matrix-40a6abbdfab01c2f890208e39b89530f.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="the-mcu-board"></a>The MCU board<a class="hash-link" href="#the-mcu-board" title="Direct link to heading">#</a></h2><p>The components:</p><ul><li>Atmega32U4</li><li>Micro USB connector</li><li>16MHz Crystal</li><li>Resistors, Capacitors, LEDs will be created &quot;inline&quot;</li></ul><p>The variables, external pins and layout looks like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scheme"><div tabindex="0" class="prism-code language-scheme codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(define mcu-module</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (make-circuit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:vars ([mcu (ATmega32U4 #:FP &quot;TQFP-44&quot;)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           [usb (USB-Micro)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           [icsp (icsp-header)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           [xtal (Crystal-4 &#x27;16MHz)])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:external-pins (row[4] col[5])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:layout (vc-append 50 (rotate usb pi) mcu icsp)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:layout ...))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Some notes about this code snippets:</p><ul><li><code>#:vars</code> section: We create several &quot;big components&quot; in the <code>#:vars</code> declaration, including the MCU, USB connector, ICSP header and crystal, because they have multiple pins and we want a handle variable to refer to them. All other components like resistors and capacitors are created &quot;inline&quot;, where we don&#x27;t really want to give them a name.</li><li><code>#:external-pins</code> section: The external pin of this module is 4+5 pins for row and column scanning of the key matrix.</li><li><code>#:layout</code> section: We layout the USB, MCU and ICSP header to be vertically appended. We don&#x27;t care much about the locations of other components such as the resistors, capacitors. They will be placed by our automatic placement engine to appropriate locations by optimizing the total wire length (formally HPWL).</li></ul><p>There are a lot of staff going on in the connection section, and we&#x27;ll describe them in small sections. First, the ICSP connector for flashing firmware:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scheme"><div tabindex="0" class="prism-code language-scheme codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(define mcu-module</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (make-circuit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:connect (*= (mcu (MOSI SCLK MISO RESET VCC GND))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">               (icsp (MOSI SCK MISO RESET VCC GND)))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ...))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Then the Power module including reset and switch:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scheme"><div tabindex="0" class="prism-code language-scheme codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(define mcu-module</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (make-circuit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:connect (*- mcu.VCC mcu.UVCC mcu.AVCC global.VCC)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:connect (*- mcu.GND mcu.UGND global.GND)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:connect (*- mcu.RESET (*&lt; (LL4148)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                           (R &#x27;10k)) global.5V)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:connect (*- mcu.RESET[-1] (Switch) global.GND)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ;; An LED for blinking</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:connect (*- mcu.PC6 (R &#x27;1k) (LED0603 &#x27;red) global.GND)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:connect (*- mcu.UCAP (C &#x27;1uf) global.GND)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:connect (*- global.VCC (*&lt; (C &#x27;1uf)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          (C &#x27;100nf)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          (C &#x27;100nf)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          (C &#x27;100nf)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                          (C &#x27;100nf))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">           global.GND)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ...))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The crystal module:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scheme"><div tabindex="0" class="prism-code language-scheme codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(define mcu-module</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (make-circuit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:connect (*- mcu.XTAL1 xtal.XIN)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:connect (*- xtal.XOUT mcu.XTAL2)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:connect (*- xtal.GND global.GND)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:connect (*- mcu.XTAL1 (C &#x27;22pf) global.GND)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:connect (*- mcu.XTAL2 (C &#x27;22pf) global.GND)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The USB connector:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scheme"><div tabindex="0" class="prism-code language-scheme codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(define mcu-module</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (make-circuit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:connect (*- mcu.D+ (R 22) usb.D+)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:connect (*- mcu.D- (R 22) usb.D-)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:connect (*- mcu.VBUS usb.VBUS global.VCC)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:connect (*- mcu.UGND usb.GND global.GND)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Finally, we select some GPIO pins for row and column scanning the matrix:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scheme"><div tabindex="0" class="prism-code language-scheme codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(define mcu-module</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  (make-circuit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:connect (*= (self row [0 3])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                 (self row [0 3])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                 (mcu [PB0 PB4 PB5 PB6]))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   #:connect (*= (self col [0 4])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                 (mcu [PD0 PD1 PD2 PD3 PD4]))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   ))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The end result would looks like this:</p><p><img alt="mcu-image" src="/assets/images/demo-board-mcu-0357b6e7c8177535e2a99d38d9cd10ea.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="connecting-the-mcu-module-and-matrix-module"></a>Connecting the MCU module and Matrix Module<a class="hash-link" href="#connecting-the-mcu-module-and-matrix-module" title="Direct link to heading">#</a></h2><p>This is simply:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scheme"><div tabindex="0" class="prism-code language-scheme codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(define keyboard (make-circuit</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> #:connect (*= (mcu-module row [0 3])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">               (matrix-module row [0 3]))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> #:connect (*= (mcu-module col [0 4])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">               (matrix-module col [0 4]))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> #:layout (vc-append mcu-module matrix-module)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  ))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>And we export the keyboard to KiCAD, PNG, BOM:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly scheme"><div tabindex="0" class="prism-code language-scheme codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">(parameterize ([current-directory &quot;./out/demo-board/keyboard&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                 [padding-general 2])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                (circuit-export keyboard</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                #:auto-place #t</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                #:formats &#x27;(kicad pdf png bom)))</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The keyboard looks like this:</p><p><img alt="keyboard-img" src="/assets/images/demo-board-keyboard-366d85029b510c70e93bd981db8b85be.png"></p><p>The BOM.csv contains the mapping from the annotations (e.g. U1, R4, D3) to the component name, footprint, and value.</p><table><thead><tr><th align="center"><strong>Annotation</strong></th><th align="center"><strong> Name</strong></th><th align="center"><strong> Footprint</strong></th><th align="center"><strong> Values</strong></th></tr></thead><tbody><tr><td align="center">U36</td><td align="center">kailh-socket</td><td align="center">1</td><td align="center">()</td></tr><tr><td align="center">D37</td><td align="center">1N4148W</td><td align="center">#f</td><td align="center">()</td></tr><tr><td align="center">U38</td><td align="center">kailh-socket</td><td align="center">1</td><td align="center">()</td></tr><tr><td align="center">D39</td><td align="center">1N4148W</td><td align="center">#f</td><td align="center">()</td></tr><tr><td align="center">U40</td><td align="center">kailh-socket</td><td align="center">1</td><td align="center">()</td></tr><tr><td align="center">U41</td><td align="center">ATmega16U4/ATmega32U4</td><td align="center">TQFP-44</td><td align="center">()</td></tr><tr><td align="center">U42</td><td align="center">USB-Micro</td><td align="center">#f</td><td align="center">()</td></tr><tr><td align="center">U43</td><td align="center">PinHeader2</td><td align="center">3</td><td align="center">()</td></tr><tr><td align="center">U44</td><td align="center">Crystal-4</td><td align="center">#f</td><td align="center">(16MHz)</td></tr><tr><td align="center">R45</td><td align="center">Resistor/R</td><td align="center">0603</td><td align="center">(1k)</td></tr><tr><td align="center">LED46</td><td align="center">LED0603</td><td align="center">#f</td><td align="center">(red)</td></tr><tr><td align="center">D47</td><td align="center">LL4148</td><td align="center">#f</td><td align="center">()</td></tr><tr><td align="center">R48</td><td align="center">Resistor/R</td><td align="center">0603</td><td align="center">(10k)</td></tr><tr><td align="center">KEY49</td><td align="center">SKRPACE010</td><td align="center">#f</td><td align="center">()</td></tr><tr><td align="center">C50</td><td align="center">Capacitor/C</td><td align="center">#f</td><td align="center">(1uf)</td></tr><tr><td align="center">C51</td><td align="center">Capacitor/C</td><td align="center">#f</td><td align="center">(1uf)</td></tr><tr><td align="center">C52</td><td align="center">Capacitor/C</td><td align="center">#f</td><td align="center">(100nf)</td></tr><tr><td align="center">C53</td><td align="center">Capacitor/C</td><td align="center">#f</td><td align="center">(100nf)</td></tr><tr><td align="center">C54</td><td align="center">Capacitor/C</td><td align="center">#f</td><td align="center">(100nf)</td></tr><tr><td align="center">C55</td><td align="center">Capacitor/C</td><td align="center">#f</td><td align="center">(100nf)</td></tr><tr><td align="center">C56</td><td align="center">Capacitor/C</td><td align="center">#f</td><td align="center">(22pf)</td></tr><tr><td align="center">C57</td><td align="center">Capacitor/C</td><td align="center">#f</td><td align="center">(22pf)</td></tr><tr><td align="center">R58</td><td align="center">Resistor/R</td><td align="center">0603</td><td align="center">(22)</td></tr><tr><td align="center">R59</td><td align="center">Resistor/R</td><td align="center">0603</td><td align="center">(22)</td></tr></tbody></table><p>The <code>.kicad_pcb</code> file can be opened by the popular open source PCB EDA software KiCAD. The routing can be done by the open source freerouting software automatically. The end board is manufacture-ready, and looks like this in KiCAD&#x27;s 3D-viewer:</p><p><img alt="keyboard-3D" src="/assets/images/demo-board-keyboard-3D-24b8d05b02798acc4b42ae332439ee5e.png"></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/guides/getting-started.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/intro"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Introduction</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/guides/install"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Installation Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#tutorial-outline" class="table-of-contents__link">Tutorial Outline</a></li><li><a href="#setting-up" class="table-of-contents__link">Setting up</a></li><li><a href="#the-keyboard-matrix" class="table-of-contents__link">The keyboard matrix</a></li><li><a href="#the-mcu-board" class="table-of-contents__link">The MCU board</a></li><li><a href="#connecting-the-mcu-module-and-matrix-module" class="table-of-contents__link">Connecting the MCU module and Matrix Module</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/styles.bbf158e0.js"></script>
<script src="/assets/js/runtime~main.baa60e6e.js"></script>
<script src="/assets/js/main.8d2f529b.js"></script>
<script src="/assets/js/1.0e345cd4.js"></script>
<script src="/assets/js/2.94e55c7a.js"></script>
<script src="/assets/js/39.b89f9123.js"></script>
<script src="/assets/js/41.375d16b8.js"></script>
<script src="/assets/js/935f2afb.ef568aff.js"></script>
<script src="/assets/js/17896441.c363ac0b.js"></script>
<script src="/assets/js/c9ea0dcf.2f61de33.js"></script>
</body>
</html>